<!DOCTYPE html>

<script src="https://d3js.org/d3.v5.min.js"></script>
<%= google_fonts 'Raleway' %>

<style>

body {
  font-family: 'Raleway';
}

h2 {
  color: #fff4d2 ;
  margin: 2px 0 20px 0;
  font-size: 1.7em;
}

chart[name=new-users] div {
  display: inline-block;
  background-color: /* purple */ #b929dc ;
  color: pink;
  width: 30px;
  /* float: left; */
  margin-right: 2px;
  bottom: 0;
  border-radius: 3px;
  vertical-align: bottom;
  transition: height .2s;
  /* text-align: center; */
}

chart[name=new-users] {
  clear: both;
  background-color: /* pink */ #ff7be2;
  display: block;
  padding: 10px;
  margin: 11px;
  border-radius: 7px;
}
</style>

<chart name=new-users>
  <h2>New User Signups</h2>
</chart>

<script>

  // Polyfill @name query selector shorthand.
  //   @bob becomes [name=bob]
  //   div@jan becomes div[name=jan]
  (function() {
    var _select = d3.select;
    d3.select = function(selector) {
      // expand @name
      selector = selector.replace(/(.*)@(.+)/, '$1[name=$2]' )

      return _select(selector);
    }
  }());

  var newUsers = <%= raw @new_users.to_json %>;

  var chart = d3.select('chart@new-users')

  var x = d3.scaleLinear()
      .domain([0, d3.max(newUsers, function(d) {return d.value})])
      .range([0, 420]);

  chart.selectAll("div")
    .data(newUsers)
  .enter().append("div")
    .style("height", function(d) { return x(d.value) + "px"; })
    // .text(function(d) { return d.value; });
    // .text(function(d) { return d._id.month + "/" + d._id.year; });

</script>

<!--
References:

Letâ€™s Make a Bar Chart, https://bost.ocks.org/mike/bar/
  November 5, 2013, Mike Bostock
  See also: https://bost.ocks.org/mike/bar/2/
-->
